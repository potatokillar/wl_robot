# 目录说明

​	**本目录作用：使外部在source了wl_ros工作空间的后，可以通过风格一致的调用方法来启动该目录中的ros2传感器节点，方便配置以及维护各种类型的传感器驱动节点 **



## 1. 使用方法：

### 1.1 通过命令行启动传感器节点

```
./docker.sh xxx  										# 进入带界面的docker容器
source ./build_x86/install/setup.bash 					# source工作空间
ros2 launch sensor sensor.launch.py sensor_type:=mid360	# 启动型号为mid360(觅道360)传感器
```

`ros2 launch sensor sensor.launch.py sensor_type:=mid360`中**sensor_type**为**传感器型号**，目前支持的**传感器型号**如下：

- **激光雷达**支持的传感器型号有 **mid360**（觅道360）、**rs16**（速腾RS16）、**yd**（云达单线激光雷达）。
- **视觉相机**支持的传感器型号有 **d435_rgb**（英特尔d435i相机rgb模式）、**usb_camera**（普通usb驱动相机）。

​	注：**视觉相机**对应上述两个型号的驱动节点实际上可以使用**ros2官方**提供的，但是为了保持wl_ros中调用传感器驱动节点的风格一致性自己编写代码实现相关节点。

### 1.2 launch文件中启动传感器节点

```
#--- 传感器节点启动launch脚本 ---#
sensor_launch = IncludeLaunchDescription(
    PythonLaunchDescriptionSource(
        os.path.join(
            get_package_share_directory('sensor'),
            'launch',
            'sensor.launch.py')),
    launch_arguments={
    	'sensor_type' : 'rs16'     					# 传感器型号 rs16（速腾RS16）
    }.items()
)
```

​	将上述ros2的python启动文件脚本**复制到目标launch文件中**，将**传感器型号参数**改为**目标传感器型号**即可在运行时启动该传感器节点发布对应ros2消息数据。

### 1.3 自行添加传感器启动文件

#### 1.3.1 官方有提供对应ros2驱动功能包

	1. 将官方的ros2驱动功能包放到 `wl_ros/src/sensor/<传感器类型>/third-part/` 下，没有对应传感器类型的文件夹的话就创建一个。
	2. 在 `wl_ros/src/sensor/<传感器类型>/` 下使用ros2创建功能包功能创建一个对应传感器型号名称的功能包，在该功能包下创建一个与传感器类型相同名称的`<传感器类型>.launch.py` 文件，来对官方驱动节点或者launch文件进行调用。

​	注：最好，将官方的launch文件内容直接复制到**`<传感器类型>.launch.py`**文件中，将对应其中重要的配置文件也复制到该**<传感器类型>功能包**的config中，以减少对官方源码的修改，注意要在**cmakelist中**使用**install将launch、config**文件夹安装到 **`share/${PROJECT_NAME}/`** 文件夹下。

#### 1.3.2 使用官方API自行编写驱动功能包

 	1. 在`wl_ros/src/sensor/<传感器类型>`下创建ros2功能包，没有对应传感器类型的文件夹的话就创建一个
 	2. 在功能包中编写驱动节点cpp或者python文件。
 	3. 在该功能包下创建一个与传感器类型相同名称的 `<传感器类型>.launch.py` 文件来启动编写的驱动节点。



## 2. 常用传感器驱动节点重点参数：

### 2.1 mid360（觅道360）

**文件路径**：**`${workspace)/src/sensor/lidar/mid360/config/MID360_config.json`**

| 参数名称          | 参数说明                                                     | 常用参数                                                     |
| ----------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **host_net_info** | **目标主机的ip地址以及端口号，端口号一般不变 **(注：当前方案是每次启动launch文件时，通过获取本机ip修改写入mid360_config.json文件中，使sdk读取的文件中的ip地址与本机一致) | **自己的主机的ip**: **192.168.1.28**<br />**orin的固定ip**: **192.168.10.150** |
| **ip**            | **雷达的固定ip**                                             | **"192.168.1.3"，<br />之后orin上要使用固定10.153的固定ip**  |

**文件路径**：**`${workspace)/src/sensor/lidar/mid360/launch/mid360.launch.py`**

| 参数名称           | 参数说明                                   | 常用参数                                     |
| ------------------ | ------------------------------------------ | -------------------------------------------- |
| **xfer_format**    | **发布的点云数据消息类型**                 | **1**: CustomMsg消息, **0**: Pointcloud2消息 |
| **frame_id**       | **激光雷达数据的发布坐标系**               | '**laser_link**'、'**base_scan**'            |
| **imu_frame_id**   | **imu数据的发布坐标系**                    | '**imu_link**'                               |
| **'cloud_in'**     | **觅道360发布的点云话题名称**              | '**livox/lidar**'                            |
| **'scan'**         | **转化为scan消息数据后发布的话题名称**     | **'/scan'**                                  |
| **'target_frame'** | **scan数据消息类型发布的坐标系**           | **laser_link**                               |
| **'min_height'**   | **转化为二维scan数据的点云的最小高度**     | **-0.05**                                    |
| **'max_height'**   | **转化为二维scan数据的点云的最大高度**     | **0.2**                                      |
| **'angle_min'**    | **转化为二维scan数据的点云扇形范围角下限** | **-3.0**                                     |
| **'angle_max'**    | **转化为二维scan数据的点云扇形范围角上限** | **3.0**                                      |
| **'range_min'**    | **转化为二维scan数据的最近点云**           | **0.2**                                      |
| **'range_max'**    | **转化为二维scan数据的最远点云**           | **30.0**                                     |

### 2.2 rs16（速腾RS16）

**文件路径**：**`${workspace)/src/sensor/lidar/rs16/config/rs16_config.yaml`**

| 参数名称                       | 参数说明                   | 常用参数                      |
| ------------------------------ | -------------------------- | ----------------------------- |
| **ros_frame_id**               | **点云数据发布的坐标系**   | **laser_link**、**base_scan** |
| **ros_send_point_cloud_topic** | **点云数据发布的话题名称** | **/rslidar_points**           |

**文件路径**：**`${workspace)/src/sensor/lidar/rs16/launch/rs16.launch.py`**

| 参数名称                                                     | 参数说明                                   | 常用参数              |
| ------------------------------------------------------------ | ------------------------------------------ | --------------------- |
| **'cloud_in'**                                               | **觅道360发布的点云话题名称**              | '**/rslidar_points**' |
| **'scan'**![image-20250325144817894](/home/wl/.config/Typora/typora-user-images/image-20250325144817894.png) | **转化为scan消息数据后发布的话题名称**     | **'/scan'**           |
| **'target_frame'**                                           | **scan数据消息类型发布的坐标系**           | **'laser_link'**      |
| **'min_height'**                                             | **转化为二维scan数据的点云的最小高度**     | **-0.05**             |
| **'max_height'**                                             | **转化为二维scan数据的点云的最大高度**     | **0.2**               |
| **'angle_min'**                                              | **转化为二维scan数据的点云扇形范围角下限** | **-3.0**              |
| **'angle_max'**                                              | **转化为二维scan数据的点云扇形范围角上限** | **3.0**               |
| **'range_min'**                                              | **转化为二维scan数据的最近点云**           | **0.2**               |
| **'range_max'**                                              | **转化为二维scan数据的最远点云**           | **30.0**              |



## 3. 常用传感器IP配置方法

### 3.1 rs16（速腾RS16）

​	**激光雷达当前固定ip为192.168.1.218，目标主机IP为192.168.1.57，想要更改需要通过window系统下的官方软件进行设置，具体设置步骤：**

1. **设置电脑固定IP为当前雷达的目标主机IP**

![1](/home/wl/Pictures/rs配置方法/1.png)

![image-20250326152045640](/home/wl/.config/Typora/typora-user-images/image-20250326152045640.png)

2. **打开官方应用软件设置目标主机IP地址以及雷达固定IP地址，软件中还支持对激光雷达视场范围等参数进行设置**

![3](/home/wl/Pictures/rs配置方法/3.png)

![4](/home/wl/Pictures/rs配置方法/4.png)

![](/home/wl/Pictures/rs配置方法/5.png)

### 3.2 mid360（觅道360）

​	**觅道360只要将主机IP设置为与激光雷达固定IP处于同一个网段下即可将主机与雷达连接，在经安装了官方的觅道360驱动包后，想要更改雷达固定IP可通过如下步骤进行设置：**

1. **将雷达与电脑主机通过网线连接上，将电脑IP网段设置为与雷达IP设置为同一个网段**

   ![image-20250326154931180](/home/wl/.config/Typora/typora-user-images/image-20250326154931180.png)

2. **通过如下链接下载官方激光雷达可视化软件**

   https://terra-1-g.djicdn.com/65c028cd298f4669a7f0e40e50ba1131/Mid360/LivoxViewer2%20for%20Ubuntu%20v2.3.0.zip

3. **将下载文件解压后，进入解压文件夹通过 .sh 文件打开可视化软件，前面主机IP设置没问题的话，该软件会自动扫描到设备，并将点云数据可视化**

   ![image-20250326154153443](/home/wl/.config/Typora/typora-user-images/image-20250326154153443.png)

4. **电机设置菜单栏即可对雷达IP进行设置，同时可以设置激光雷达扫描范围等别的参数**

   ![image-20250326155255136](/home/wl/.config/Typora/typora-user-images/image-20250326155255136.png)