# Jenkins æ—¥å¸¸ä½¿ç”¨æŒ‡å—

> **æ–‡æ¡£ä½ç½®**: `docs/ci-cd/jenkins-usage.md`
> **æœ€åæ›´æ–°**: 2025-10-13
> **ä½œè€…**: å”æ–‡æµ©

æœ¬æ–‡æ¡£æä¾› Jenkins CI çš„æ—¥å¸¸ä½¿ç”¨æ–¹æ³•å’Œæ“ä½œæŒ‡å—ã€‚

## ğŸ¯ å¿«é€Ÿæ€»ç»“

Jenkins ä»»åŠ¡ `iiri-layered-build-ci` å·²é…ç½®å®Œæˆï¼Œæä¾›è‡ªåŠ¨åŒ–çš„åˆ†å±‚ç¼–è¯‘å’Œæ„å»ºéªŒè¯ã€‚

**Jenkins åœ°å€**: http://192.168.1.59:8081/job/iiri-layered-build-ci

## ğŸ“‹ ä»»åŠ¡ä¿¡æ¯

### å·²é…ç½®å†…å®¹

- âœ… **Jenkins ä»»åŠ¡**: `iiri-layered-build-ci`
- âœ… **Git ä»“åº“**: `http://192.168.1.55/ontology/iiri_ros2_architecture.git`
- âœ… **Git å‡­æ®**: ID ä¸º `git-cred`
- âœ… **è‡ªåŠ¨è§¦å‘**: æ¯ 2 å°æ—¶æ£€æŸ¥ä¸€æ¬¡ä»£ç å˜æ›´
- âœ… **æ„å»ºä¿ç•™**: ä¿ç•™æœ€è¿‘ 10 æ¬¡æ„å»ºï¼Œäº§ç‰©ä¿ç•™ 5 æ¬¡

### æ„å»ºå‚æ•°

| å‚æ•° | é€‰é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| **ARCHITECTURE** | x86, arm | x86 | ç›®æ ‡æ¶æ„ |
| **ENABLE_CERES** | true, false | false | å¯ç”¨ Ceres ä¼˜åŒ–ï¼ˆç”¨äº path_trackerï¼‰ |
| **BUILD_MODE** | debug, release | debug | ARM æ„å»ºæ¨¡å¼ |

**BUILD_MODE è¯´æ˜**ï¼ˆä»… ARM æ¶æ„ç”Ÿæ•ˆï¼‰:
- **debug**: Jenkins QEMU ç¼–è¯‘ï¼ˆæœ‰é™åˆ¶ï¼Œå¿«é€Ÿæµ‹è¯•ï¼‰
- **release**: Orin ç¡¬ä»¶ç¼–è¯‘ï¼ˆæ— é™åˆ¶ï¼Œç”Ÿäº§å‘å¸ƒï¼‰

## ğŸš€ è§¦å‘æ„å»º

### æ–¹å¼ 1: Web UIï¼ˆæ¨èï¼‰

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://192.168.1.59:8081/job/iiri-layered-build-ci
2. ç‚¹å‡» **"Build with Parameters"**
3. é€‰æ‹©å‚æ•°ï¼š
   - ARCHITECTURE: é€‰æ‹© x86 æˆ– arm
   - ENABLE_CERES: æ˜¯å¦å¯ç”¨ä¼˜åŒ–
   - BUILD_MODE: ARM æ„å»ºæ¨¡å¼
4. ç‚¹å‡» **"Build"** å¼€å§‹æ„å»º

### æ–¹å¼ 2: ä½¿ç”¨è§¦å‘è„šæœ¬

```bash
# x86 æ¶æ„æ„å»ºï¼ˆé»˜è®¤ï¼‰
cd jenkins
./trigger_build.sh x86 false

# ARM Debug æ¨¡å¼ï¼ˆQEMU ç¼–è¯‘ï¼‰
./trigger_build.sh arm false

# ARM Release æ¨¡å¼éœ€è¦æ‰‹åŠ¨åœ¨ UI é€‰æ‹© BUILD_MODE=release
```

### æ–¹å¼ 3: è‡ªåŠ¨è§¦å‘

ä»£ç æ¨é€åˆ° `master` åˆ†æ”¯åï¼ŒJenkins ä¼šåœ¨ 2 å°æ—¶å†…è‡ªåŠ¨æ£€æµ‹å¹¶å¼€å§‹æ„å»ºã€‚

**è§¦å‘æ¡ä»¶**:
- å®šæ—¶æ£€æŸ¥ï¼šæ¯ 2 å°æ—¶ï¼ˆH */2 * * *ï¼‰
- æ£€æµ‹åˆ° Git å˜æ›´è‡ªåŠ¨è§¦å‘

## ğŸ“Š æŸ¥çœ‹æ„å»ºçŠ¶æ€

### Web UI æŸ¥çœ‹

**æ„å»ºå†å²**ï¼š
- ä»»åŠ¡ä¸»é¡µ: http://192.168.1.59:8081/job/iiri-layered-build-ci
- æ˜¾ç¤ºæœ€è¿‘çš„æ„å»ºåˆ—è¡¨ï¼Œé¢œè‰²è¡¨ç¤ºçŠ¶æ€ï¼š
  - ğŸ”µ è“è‰²ï¼šæˆåŠŸ
  - ğŸ”´ çº¢è‰²ï¼šå¤±è´¥
  - âšª ç°è‰²ï¼šæœªæ‰§è¡Œ
  - ğŸ”µâ³ é—ªçƒï¼šæ­£åœ¨æ„å»º

**æ„å»ºè¯¦æƒ…**ï¼š
- ç‚¹å‡»æ„å»ºç¼–å·ï¼ˆå¦‚ #123ï¼‰æŸ¥çœ‹è¯¦æƒ…
- **Console Output**: æŸ¥çœ‹å®Œæ•´æ—¥å¿—
- **Changes**: æŸ¥çœ‹æœ¬æ¬¡æ„å»ºçš„ä»£ç å˜æ›´
- **Artifacts**: ä¸‹è½½æ„å»ºäº§ç‰©ï¼ˆéƒ¨ç½²åŒ…ï¼‰

### å‘½ä»¤è¡ŒæŸ¥çœ‹

```bash
# æŸ¥çœ‹æœ€æ–°æ„å»ºçŠ¶æ€
curl -s "http://admin:westlake@192.168.1.59:8081/job/iiri-layered-build-ci/lastBuild/api/json" \
  | python3 -c "import sys, json; d=json.load(sys.stdin); print(f\"ç»“æœ: {d['result']}, ç¼–å·: {d['number']}\")"

# æŸ¥çœ‹æ„å»ºæ—¥å¿—ï¼ˆæœ€å 100 è¡Œï¼‰
curl -s "http://admin:westlake@192.168.1.59:8081/job/iiri-layered-build-ci/lastBuild/consoleText" \
  | tail -100
```

### ä½¿ç”¨è„šæœ¬ç›‘æ§

```bash
# å®æ—¶ç›‘æ§æœ€æ–°æ„å»ºï¼ˆjenkins/watch_latest_build.shï¼‰
cd jenkins
./watch_latest_build.sh
```

## ğŸ”„ æ„å»ºæµç¨‹

Jenkins ä¼šæŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š

```
1. æ¸…ç†å·¥ä½œç©ºé—´
   â†“
2. æ‹‰å–ä¸»ä»“åº“ (master åˆ†æ”¯)
   â†“
3. é…ç½® Git å‡­æ®
   â†“
4. æ£€æŸ¥ vcstool å’Œ Docker
   â†“
5. å¯¼å…¥åˆ†å±‚ä»“åº“ (./sync.sh import)
   â”œâ”€â”€ core_layer
   â”œâ”€â”€ hardware_layer
   â”œâ”€â”€ perception_layer
   â”œâ”€â”€ intelligence_layer
   â””â”€â”€ application_layer
   â†“
6. ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯
   â†“
7. ç¼–è¯‘å„å±‚ï¼ˆåˆ†å±‚æ„å»ºï¼‰
   â”œâ”€â”€ Core Layer (3-5åˆ†é’Ÿ)
   â”œâ”€â”€ Hardware Layer (5-10åˆ†é’Ÿ)
   â”œâ”€â”€ Perception Layer (5-10åˆ†é’Ÿ)
   â”œâ”€â”€ Intelligence Layer (10-15åˆ†é’Ÿ)
   â””â”€â”€ Application Layer (5-10åˆ†é’Ÿ)
   â†“
8. æ‰“åŒ…éƒ¨ç½²åŒ…
   - ç”Ÿæˆ iiri-ros-{arch}-{version}.tar.gz
   - ç”Ÿæˆ SHA256 æ ¡éªŒæ–‡ä»¶
   - ç”Ÿæˆ VERSION.txt
   â†“
9. å½’æ¡£æ„å»ºäº§ç‰©
   - éƒ¨ç½²åŒ… (deploy_packages/*.tar.gz)
   - æ ¡éªŒæ–‡ä»¶ (*.sha256)
   - ç‰ˆæœ¬ä¿¡æ¯ (VERSION.txt)
   - ç¼–è¯‘æ—¥å¿— (build_*_shared/*/log/*.log)
   â†“
10. æ¸…ç†ï¼ˆARM Release æ¨¡å¼æ¸…ç† Orin æ„å»ºç›®å½•ï¼‰
```

**æ€»è€—æ—¶**ï¼šçº¦ 30-60 åˆ†é’Ÿï¼ˆå–å†³äºæ¶æ„å’Œç¼“å­˜ï¼‰

## ğŸ“¦ ä¸‹è½½æ„å»ºäº§ç‰©

### ä» Web UI ä¸‹è½½

1. è®¿é—®ä»»åŠ¡ä¸»é¡µ
2. ç‚¹å‡»æ„å»ºç¼–å·
3. åœ¨å·¦ä¾§æ ç‚¹å‡» **"Build Artifacts"**
4. ä¸‹è½½æ–‡ä»¶ï¼š
   - `deploy_packages/iiri-ros-{arch}-{version}.tar.gz` - éƒ¨ç½²åŒ…
   - `deploy_packages/iiri-ros-{arch}-{version}.tar.gz.sha256` - æ ¡éªŒæ–‡ä»¶
   - `deploy_packages/iiri-ros-{arch}-{version}/VERSION.txt` - ç‰ˆæœ¬ä¿¡æ¯

### ä½¿ç”¨ wget ä¸‹è½½

```bash
# ä¸‹è½½æœ€æ–°æˆåŠŸæ„å»ºçš„éƒ¨ç½²åŒ…ï¼ˆx86ï¼‰
wget http://admin:westlake@192.168.1.59:8081/job/iiri-layered-build-ci/lastSuccessfulBuild/artifact/deploy_packages/iiri-ros-x86-*.tar.gz

# ä¸‹è½½æ ¡éªŒæ–‡ä»¶
wget http://admin:westlake@192.168.1.59:8081/job/iiri-layered-build-ci/lastSuccessfulBuild/artifact/deploy_packages/iiri-ros-x86-*.tar.gz.sha256

# éªŒè¯å®Œæ•´æ€§
sha256sum -c iiri-ros-x86-*.tar.gz.sha256
```

### ä¸‹è½½ç‰¹å®šæ„å»º

```bash
# ä¸‹è½½æ„å»º #123 çš„äº§ç‰©
wget http://admin:westlake@192.168.1.59:8081/job/iiri-layered-build-ci/123/artifact/deploy_packages/iiri-ros-arm-*.tar.gz
```

## âš™ï¸ å¸¸ç”¨æ“ä½œ

### åœæ­¢æ­£åœ¨è¿è¡Œçš„æ„å»º

1. è®¿é—®æ„å»ºé¡µé¢
2. ç‚¹å‡»å·¦ä¾§æ çš„çº¢è‰² **"X"** æŒ‰é’®ï¼ˆAbortï¼‰
3. ç¡®è®¤åœæ­¢

### é‡æ–°è§¦å‘ä¸Šä¸€æ¬¡æ„å»º

1. è®¿é—®æ„å»ºé¡µé¢
2. ç‚¹å‡»å·¦ä¾§æ çš„ **"Rebuild"**
3. ä½¿ç”¨ç›¸åŒå‚æ•°é‡æ–°æ„å»º

### æŸ¥çœ‹æ„å»ºå‚æ•°

1. è®¿é—®æ„å»ºé¡µé¢
2. æŸ¥çœ‹ **"Parameters"** åŒºå—
3. æ˜¾ç¤ºæœ¬æ¬¡æ„å»ºä½¿ç”¨çš„æ‰€æœ‰å‚æ•°

### æ¯”è¾ƒä¸¤æ¬¡æ„å»º

1. è®¿é—®ä»»åŠ¡ä¸»é¡µ
2. é€‰æ‹©ä¸¤æ¬¡æ„å»º
3. ç‚¹å‡» **"Compare"**
4. æŸ¥çœ‹ä»£ç å˜æ›´å·®å¼‚

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### 1. å¿«é€ŸéªŒè¯ç¼–è¯‘

åªæ„å»ºç‰¹å®šå±‚æ¥å¿«é€ŸéªŒè¯ï¼š

```bash
# ä¿®æ”¹ core_layer åï¼Œåªæ„å»ºåˆ° core_layer
# ï¼ˆéœ€è¦ä¿®æ”¹ Jenkinsfileï¼Œé»˜è®¤æ„å»ºæ‰€æœ‰å±‚ï¼‰
```

### 2. å¹¶è¡Œæ„å»ºå¤šæ¶æ„

å¦‚æœéœ€è¦åŒæ—¶æ„å»º x86 å’Œ ARMï¼š

1. æ‰‹åŠ¨è§¦å‘ä¸¤æ¬¡æ„å»º
2. ç¬¬ä¸€æ¬¡é€‰æ‹© x86
3. ç¬¬äºŒæ¬¡é€‰æ‹© arm
4. ä¸¤æ¬¡æ„å»ºä¼šå¹¶è¡Œæ‰§è¡Œï¼ˆå¦‚æœ Jenkins executor è¶³å¤Ÿï¼‰

### 3. æ„å»ºå¤±è´¥åçš„æ“ä½œ

1. **æŸ¥çœ‹æ—¥å¿—**ï¼šç‚¹å‡» Console Output æŸ¥çœ‹è¯¦ç»†é”™è¯¯
2. **æœ¬åœ°å¤ç°**ï¼šæ ¹æ®æ—¥å¿—åœ¨æœ¬åœ°å¤ç°é—®é¢˜
   ```bash
   ./build_layered.sh -c x86 [å¤±è´¥çš„å±‚]
   ```
3. **ä¿®å¤åé‡æ–°æ„å»º**ï¼šæ¨é€ä»£ç åè‡ªåŠ¨è§¦å‘ï¼Œæˆ–æ‰‹åŠ¨è§¦å‘

### 4. å®šæœŸæ¸…ç†

Jenkins ä¼šè‡ªåŠ¨ä¿ç•™æœ€è¿‘ 10 æ¬¡æ„å»ºï¼Œä½†å¯ä»¥æ‰‹åŠ¨æ¸…ç†ï¼š

1. è®¿é—®ä»»åŠ¡ä¸»é¡µ
2. ç‚¹å‡»å·¦ä¾§æ  **"Workspace"**
3. ç‚¹å‡» **"Wipe Out Workspace"** æ¸…ç†å·¥ä½œç©ºé—´

## ğŸ“ˆ ç›‘æ§å’Œé€šçŸ¥

### æ„å»ºçŠ¶æ€ç›‘æ§

**æ–¹æ³• 1**: æµè§ˆå™¨ä¹¦ç­¾
- å°†ä»»åŠ¡é¡µé¢åŠ å…¥ä¹¦ç­¾
- å®šæœŸæŸ¥çœ‹æ„å»ºçŠ¶æ€

**æ–¹æ³• 2**: ä½¿ç”¨ç›‘æ§è„šæœ¬
```bash
# ä½¿ç”¨æä¾›çš„ç›‘æ§è„šæœ¬
./jenkins/watch_latest_build.sh

# æˆ–è€…è‡ªå®šä¹‰è„šæœ¬æ£€æŸ¥
while true; do
  curl -s "http://admin:westlake@192.168.1.59:8081/job/iiri-layered-build-ci/lastBuild/api/json" \
    | jq -r '"\(.number): \(.result // "BUILDING")"'
  sleep 30
done
```

### é‚®ä»¶é€šçŸ¥ï¼ˆéœ€è¦é…ç½®ï¼‰

å¦‚æœé…ç½®äº†é‚®ä»¶é€šçŸ¥ï¼Œæ„å»ºå¤±è´¥æ—¶ä¼šè‡ªåŠ¨å‘é€é‚®ä»¶ã€‚

## ğŸ”— ç›¸å…³æ–‡æ¡£

- **[Jenkins é…ç½®æŒ‡å—](jenkins-setup.md)** - è¯¦ç»†é…ç½®è¯´æ˜
- **[Jenkins æ•…éšœæ’é™¤](../reference/jenkins-troubleshooting.md)** - å¸¸è§é—®é¢˜è§£å†³
- **[éƒ¨ç½²æŒ‡å—](../deployment/deployment-guide.md)** - éƒ¨ç½²åŒ…ä½¿ç”¨
- **[Jenkinsfile è¯´æ˜](../../Jenkinsfile)** - Pipeline é…ç½®

## ğŸ’¬ è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜ï¼Ÿ

1. **æŸ¥çœ‹æ„å»ºæ—¥å¿—** - Console Output ä¸­æœ‰è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. **å‚è€ƒæ•…éšœæ’é™¤æ–‡æ¡£** - [jenkins-troubleshooting.md](../reference/jenkins-troubleshooting.md)
3. **è”ç³»å›¢é˜Ÿ** - æŠ€æœ¯æ”¯æŒæˆ–é¡¹ç›®è´Ÿè´£äºº

---

**æœ€åæ›´æ–°**: 2025-10-13
**ä½œè€…**: å”æ–‡æµ©
